{
  "name": "Jumia -> Intella Transform (POC)",
  "nodes": [
    {
      "id": "1",
      "name": "Transform Jumia to Intella",
      "type": "n8n-nodes-base.code",
      "typeVersion": 1,
      "position": [400, 300],
      "parameters": {
        "functionCode": "# n8n Code node: Transformation Logic based on \"Intella Product Feed.docx\"\n# This code expects `_input.all()` to provide the incoming items inside n8n.\n\ndef _to_float(v):\n    try:\n        if v is None:\n            return None\n        if isinstance(v, (int, float)):\n            return float(v)\n        s = str(v).strip()\n        if s == \"\":\n            return None\n        return float(s)\n    except Exception:\n        return None\n\n\ndef transform_items(input_items):\n    output_data = []\n    for item in input_items:\n        product = item.get(\"json\") if isinstance(item, dict) and \"json\" in item else item\n\n        # --- QUALITY GATES ---\n        stock = _to_float(product.get(\"mtr_stock\", 0)) or 0\n        if stock <= 0:\n            # Rule: Stock > 0 required\n            continue\n\n        # --- CATEGORY HIERARCHY (l1..l8) ---\n        cat_parts = []\n        for i in range(1, 9):\n            val = product.get(f\"dsc_category_name_l{i}\")\n            if val:\n                cat_parts.append(val)\n        full_category = \" > \".join(cat_parts)\n\n        # --- Jumia Express ---\n        is_express = 1 if str(product.get(\"dsc_custom_label_one\")).strip() == '1' else 0\n\n        # --- SIMPLE SKU construction ---\n        base_sku = product.get(\"cod_sku\", \"UNKNOWN\")\n        size = product.get(\"dsc_size\")\n        simple_sku = f\"{base_sku}-{size}\" if size else base_sku\n\n        # --- MAPPING ---\n        mapped_product = {\n            \"SKU\": base_sku,\n            \"simple_sku\": simple_sku,\n            \"stock\": int(stock),\n            \"Title\": product.get('dsc_name_en') or product.get('dsc_name_fr') or \"No Title\",\n            \"URL\": product.get('dsc_product_url'),\n            \"imageUrl\": product.get('dsc_url_image'),\n            \"originalPrice\": product.get('dsc_original_price'),\n            \"salePrice\": product.get('mtr_price'),\n            \"discount\": product.get('mtr_price_discount'),\n            \"brand\": product.get('dsc_brand_name'),\n            \"category\": full_category,\n            \"is_express\": is_express,\n            \"rating\": product.get('mtr_rating'),\n            \"rating_count\": product.get('mtr_rating_count'),\n            \"model\": product.get('attr_model'),\n            \"warranty\": product.get('attr_warranty_duration'),\n        }\n\n        output_data.append({\"json\": mapped_product})\n\n    return output_data\n\n\n# Execute inside n8n\nitems = _input.all()\nreturn transform_items(items)"
      }
    }
  ],
  "connections": {}
}
